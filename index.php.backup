<?php
/**
 * Archivo de entrada principal que redirige todas las peticiones a la carpeta public
 */

// Obtener la URL solicitada
$request_uri = $_SERVER['REQUEST_URI'];
$base_path = dirname($_SERVER['SCRIPT_NAME']);

// Remover el path base de la URL
$path = str_replace($base_path, '', $request_uri);
$path = parse_url($path, PHP_URL_PATH);

// Si la URL no termina en .php y no es un archivo o directorio existente, redirigir a public
if (!preg_match('/\.(php|css|js|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$/', $path) && 
    !file_exists(__DIR__ . $path) && 
    !is_dir(__DIR__ . $path)) {
    
    // Construir la nueva URL
    $new_url = '/public' . $path;
    
    // Preservar query string si existe
    if (isset($_SERVER['QUERY_STRING']) && !empty($_SERVER['QUERY_STRING'])) {
        $new_url .= '?' . $_SERVER['QUERY_STRING'];
    }
    
    // Redirigir a la carpeta public
    header('Location: ' . $new_url);
    exit;
}

// Si es un archivo PHP específico, incluirlo directamente
if (preg_match('/\.php$/', $path)) {
    $file_path = __DIR__ . $path;
    if (file_exists($file_path)) {
        include $file_path;
        exit;
    }
}

// Si llegamos aquí, incluir el index.php de public
include __DIR__ . '/public/index.php'; 